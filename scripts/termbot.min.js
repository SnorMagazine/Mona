function ElizaBot(a){this.noRandom=a?!0:!1,this.capitalizeFirstLetter=!0,this.debug=!1,this.memSize=100,this.version="1.1 (original)",this._dataParsed||this._init(),this.reset()}var Terminal=function(a){if("object"!=typeof a)a=Object();else for(var b in this.Defaults)a[b]===void 0&&(a[b]=this.Defaults[b]);this.conf=a,this.setInitValues()};Terminal.prototype={version:"1.59 (original)",Defaults:{cols:80,rows:24,x:100,y:100,termDiv:"termDiv",bgColor:"#181818",frameColor:"#555555",frameWidth:1,rowHeight:15,blinkDelay:500,fontClass:"term",crsrBlinkMode:!1,crsrBlockMode:!0,DELisBS:!1,printTab:!0,printEuro:!0,catchCtrlH:!0,closeOnESC:!0,historyUnique:!1,id:0,ps:">",greeting:"%+r Terminal ready. %-r",handler:this.defaultHandler,ctrlHandler:null,initHandler:null,exitHandler:null,wrapping:!1,mapANSI:!1,ANSItrueBlack:!1},setInitValues:function(){this.isSafari=navigator.userAgent.indexOf("Safari")>=0||navigator.userAgent.indexOf("WebKit")>=0?!0:!1,this.isOpera=window.opera&&navigator.userAgent.indexOf("Opera")>=0?!0:!1,this.isChrome=navigator.userAgent.indexOf("Chrome/")>=0&&navigator.userAgent.indexOf("WebKit")>=0?!0:!1,this.domAPI=document&&document.createElement?!0:!1,this.isMac=navigator.userAgent.indexOf("Mac")>=0?!0:!1,this.id=this.conf.id,this.maxLines=this.conf.rows,this.maxCols=this.conf.cols,this.termDiv=this.conf.termDiv,this.crsrBlinkMode=this.conf.crsrBlinkMode,this.crsrBlockMode=this.conf.crsrBlockMode,this.blinkDelay=this.conf.blinkDelay,this.DELisBS=this.conf.DELisBS,this.printTab=this.conf.printTab,this.printEuro=this.conf.printEuro,this.catchCtrlH=this.conf.catchCtrlH,this.closeOnESC=this.conf.closeOnESC,this.historyUnique=this.conf.historyUnique,this.ps=this.conf.ps,this.closed=!1,this.r,this.c,this.charBuf=Array(),this.styleBuf=Array(),this.scrollBuf=null,this.blinkBuffer=0,this.blinkTimer,this.cursoractive=!1,this.lock=!0,this.insert=!1,this.charMode=!1,this.rawMode=!1,this.lineBuffer="",this.inputChar=0,this.lastLine="",this.guiCounter=0,this.history=Array(),this.histPtr=0,this.env=Object(),this.buckupBuffer=null,this.handler=this.conf.handler,this.wrapping=this.conf.wrapping,this.mapANSI=this.conf.mapANSI,this.ANSItrueBlack=this.conf.ANSItrueBlack,this.ctrlHandler=this.conf.ctrlHandler,this.initHandler=this.conf.initHandler,this.exitHandler=this.conf.exitHandler},defaultHandler:function(){this.newLine(),""!=this.lineBuffer&&(this.type("You typed: "+this.lineBuffer),this.newLine()),this.prompt()},open:function(){return this.termDivReady()?(this.closed||this._makeTerm(),this.init(),!0):!1},close:function(){this.lock=!0,this.cursorOff(),this.exitHandler&&this.exitHandler(),this.globals.setVisible(this.termDiv,0),this.closed=!0},init:function(){if(this.guiReady())this.guiCounter=0,this.closed&&this.setInitValues(),this.clear(),this.globals.setVisible(this.termDiv,1),this.globals.enableKeyboard(this),this.initHandler?this.initHandler():(this.write(this.conf.greeting),this.newLine(),this.prompt());else{if(this.guiCounter++,this.guiCounter>18e3){if(!confirm("Terminal:\nYour browser hasn't responded for more than 2 minutes.\nRetry?"))return;this.guiCounter=0}this.globals.termToInitialze=this,window.setTimeout("Terminal.prototype.globals.termToInitialze.init()",200)}},getRowArray:function(a,b){for(var c=Array(),d=0;a>d;d++)c[d]=b;return c},wrapOn:function(){this.wrapping=!0},wrapOff:function(){this.wrapping=!1},type:function(a,b){for(var c=0;a.length>c;c++){var d=a.charCodeAt(c);this.isPrintable(d)||(d=94),this.charBuf[this.r][this.c]=d,this.styleBuf[this.r][this.c]=b?b:0;var e=this.r;this._incCol(),this.r!=e&&this.redraw(e)}this.redraw(this.r)},write:function(a,b){if("object"!=typeof a){if("string"!=typeof a&&(a=""+a),a.indexOf("\n")>=0){var c=a.split("\n");a=c.join("%n")}}else if(a=a.join?a.join("%n"):""+a,a.indexOf("\n")>=0){var c=a.split("\n");a=c.join("%n")}this.mapANSI&&(a=this.globals.ANSI_map(a,this.ANSItrueBlack)),this._sbInit(b);for(var d=a.split("%"),e="%"!=a.charAt(0),f=0,g=this.globals.termStyleMarkup,h=0;d.length>h;h++)if(e)d[h].length>0?this._sbType(d[h],f):h>0&&this._sbType("%",f),e=!1;else{var i=d[h].charAt(0);if(0==d[h].length&&h>0)this._sbType("%",f),e=!0;else if("n"==i)this._sbNewLine(!0),d[h].length>1&&this._sbType(d[h].substring(1),f);else if("+"==i){var j=d[h].charAt(1);j=j.toLowerCase(),"p"==j?f=0:g[j]&&(f|=g[j]),d[h].length>2&&this._sbType(d[h].substring(2),f)}else if("-"==i){var j=d[h].charAt(1);j=j.toLowerCase(),"p"==j?f=0:g[j]&&(f&=~g[j]),d[h].length>2&&this._sbType(d[h].substring(2),f)}else if(d[h].length>1&&"c"==i){var k=this._parseColor(d[h].substring(1));f=-16777201&f|k.style,k.rest&&this._sbType(k.rest,f)}else d[h].length>1&&"C"==d[h].charAt(0)&&"S"==d[h].charAt(1)?(this.clear(),this._sbInit(),d[h].length>2&&this._sbType(d[h].substring(2),f)):d[h].length>0&&this._sbType(d[h],f)}this._sbOut()},_parseColor:function(a){var b="",c=0;if(a.length)if("("==a.charAt(0)){for(var d="",e=1;a.length>e;e++){var f=a.charAt(e);if(")"==f){a.length>e&&(b=a.substring(e+1));break}d+=f}if(d)if("@"==d.charAt(0)){var g=this.globals.nsColors[d.substring(1).toLowerCase()];g&&(c=256*(16+g))}else if("#"==d.charAt(0)){var h=d.substring(1).toLowerCase(),g=this.globals.webColors[h];g?c=65536*g:(h=this.globals.webifyColor(h),h&&(c=65536*this.globals.webColors[h]))}else if(d.length&&2>=d.length){for(var i=!1,e=0;d.length>e;e++)if(this.globals.isHexOnlyChar(d.charAt(e))){i=!0;break}var h=i?parseInt(d,16):parseInt(d,10);(!isNaN(h)||15>=h)&&(c=256*h)}else c=256*this.globals.getColorCode(d)}else{var f=a.charAt(0);this.globals.isHexChar(f)?(c=256*this.globals.hexToNum[f],b=a.substring(1)):b=a}return{rest:b,style:c}},_sbInit:function(a){var b=this.scrollBuf=Object(),c=b.lines=Array(),d=b.styles=Array();b.more=a,b.line=0,b.status=0,b.r=0,b.c=this.c,c[0]=this.getRowArray(this.conf.cols,0),d[0]=this.getRowArray(this.conf.cols,0);for(var e=0;this.c>e;e++)c[0][e]=this.charBuf[this.r][e],d[0][e]=this.styleBuf[this.r][e]},_sbType:function(a,b){for(var c=this.scrollBuf,d=0;a.length>d;d++){var e=a.charCodeAt(d);this.isPrintable(e)||(e=94),c.lines[c.r][c.c]=e,c.styles[c.r][c.c++]=b?b:0,c.c>=this.maxCols&&this._sbNewLine()}},_sbNewLine:function(a){var b=this.scrollBuf;this.wrapping&&a&&(b.lines[b.r][b.c]=10,b.lines[b.r].length=b.c+1),b.r++,b.c=0,b.lines[b.r]=this.getRowArray(this.conf.cols,0),b.styles[b.r]=this.getRowArray(this.conf.cols,0)},_sbWrap:function(){var a=Object();a.lines=Array(),a.styles=Array(),a.lines[0]=this.getRowArray(this.conf.cols,0),a.styles[0]=this.getRowArray(this.conf.cols,0),a.r=0,a.c=0;var e,f,g,h,i,b=this.scrollBuf,c=b.lines,d=b.styles,j=this.c,k=0,l=0;a.cBreak=!1;for(var m=0;c.length>m;m++){h=c[m],i=d[m];for(var n=0;h.length>n;n++)if(e=h[n],f=i[n],e){var g=this.globals.wrapChars[e];10==e&&(g=1),g?(2==g?j++:4==g&&(j++,h[n]=45),this._wbOut(a,k,l,j),10==e?this._wbIncLine(a):1==g&&a.c<this.maxCols&&(a.lines[a.r][a.c]=e,a.styles[a.r][a.c++]=f,a.c>=this.maxCols&&this._wbIncLine(a)),3==g?(k=m,l=n,j=1):(j=0,k=m,l=n+1,l==h.length&&(k++,l=0),4==g&&(a.cBreak=!0))):j++}}j&&(a.cbreak&&0!=a.c&&a.c--,this._wbOut(a,k,l,j)),b.lines=a.lines,b.styles=a.styles,b.r=a.r,b.c=a.c},_wbOut:function(a,b,c,d){var i,j,e=this.scrollBuf,f=e.lines,g=e.styles,h=0;if(d+a.c>this.maxCols)if(this.maxCols>d)this._wbIncLine(a);else{var k=0;for(h=this.maxCols-a.c,i=f[b],j=g[b];;){for(var l=k;h>l;l++)a.lines[a.r][a.c]=i[c],a.styles[a.r][a.c++]=j[c++],c==f[b].length&&(c=0,b++,i=f[b],j=g[b]);if(this._wbIncLine(a),this.maxCols>d-h)break;k=h,h+=this.maxCols}}else a.cBreak&&a.c--;i=f[b],j=g[b];for(var l=h;d>l;l++)a.lines[a.r][a.c]=i[c],a.styles[a.r][a.c++]=j[c++],c==f[b].length&&(c=0,b++,i=f[b],j=g[b]);a.cBreak=!1},_wbIncLine:function(a){a.r++,a.c=0,a.lines[a.r]=this.getRowArray(this.conf.cols,0),a.styles[a.r]=this.getRowArray(this.conf.cols,0)},_sbOut:function(){var a=this.scrollBuf;this.wrapping&&!a.status&&this._sbWrap();var b=a.lines,c=a.styles,d=this.charBuf,e=this.styleBuf,f=this.maxLines,g=b.length;if(a.more)if(a.status){if(this.inputChar==this.globals.lcMoreKeyAbort)return this.r=f-1,this.c=0,d[this.r]=this.getRowArray(this.conf.cols,0),e[this.r]=this.getRowArray(this.conf.cols,0),this.redraw(this.r),this.handler=a.handler,this.charMode=!1,this.inputChar=0,this.scrollBuf=null,this.prompt(),void 0;if(this.inputChar!=this.globals.lcMoreKeyContinue)return;this.clear()}else this.r>=f-1&&this.clear();if(f>=this.r+g-a.line){for(var h=a.line;g>h;h++){var i=this.r+h-a.line;d[i]=b[h],e[i]=c[h],this.redraw(i)}if(this.r+=a.r-a.line,this.c=a.c,a.more)return a.status&&(this.handler=a.handler),this.charMode=!1,this.inputChar=0,this.scrollBuf=null,this.prompt(),void 0}else{if(a.more){if(f--,0==a.status&&(a.handler=this.handler,this.handler=this._sbOut,this.charMode=!0,a.status=1),this.r)for(var j=f-this.r,h=a.line;j>h;h++){var i=this.r+h-a.line;d[i]=b[h],e[i]=c[h],this.redraw(i)}else for(var j=a.line+f,h=a.line;j>h;h++){var i=this.r+h-a.line;d[i]=b[h],e[i]=c[h],this.redraw(i)}return a.line=j,this.r=f,this.c=0,this.type(this.globals.lcMorePrompt1,this.globals.lcMorePromtp1Style),this.type(this.globals.lcMorePrompt2,this.globals.lcMorePrompt2Style),this.lock=!1,void 0}if(g>=f){for(var j=g-f,h=0;f>h;h++){var i=j+h;d[h]=b[i],e[h]=c[i],this.redraw(h)}this.r=f-1,this.c=a.c}else{for(var k=f-g,j=this.r-k,h=0;k>h;h++){for(var i=j+h,l=0;this.maxCols>l;l++)d[h][l]=d[i][l],e[h][l]=e[i][l];this.redraw(h)}for(var h=0;g>h;h++){var i=k+h;d[i]=b[h],e[i]=c[h],this.redraw(i)}this.r=f-1,this.c=a.c}}this.scrollBuf=null},typeAt:function(a,b,c,d){var e=this.r,f=this.c;this.cursorSet(a,b);for(var g=0;c.length>g;g++){var h=c.charCodeAt(g);this.isPrintable(h)||(h=94),this.charBuf[this.r][this.c]=h,this.styleBuf[this.r][this.c]=d?d:0;var i=this.r;this._incCol(),this.r!=i&&this.redraw(i)}this.redraw(this.r),this.r=e,this.c=f},statusLine:function(a,b,c){var d,e;b=b&&!isNaN(b)?15&parseInt(b):0,e=c&&c>0?this.conf.rows-c:this.conf.rows-1;for(var f=0;this.conf.cols>f;f++)a.length>f?(d=a.charCodeAt(f),this.isPrintable(d)||(d=94)):d=0,this.charBuf[e][f]=d,this.styleBuf[e][f]=b;this.redraw(e)},printRowFromString:function(a,b,c){var d;if(c=c&&!isNaN(c)?15&parseInt(c):0,a>=0&&this.maxLines>a){"string"!=typeof b&&(b=""+b);for(var e=0;this.conf.cols>e;e++)b.length>e?(d=b.charCodeAt(e),this.isPrintable(d)||(d=94)):d=0,this.charBuf[a][e]=d,this.styleBuf[a][e]=c;this.redraw(a)}},setChar:function(a,b,c,d){this.charBuf[b][c]=a,this.styleBuf[this.r][this.c]=d?d:0,this.redraw(b)},newLine:function(){this.c=0,this._incRow()},_charOut:function(a,b){this.charBuf[this.r][this.c]=a,this.styleBuf[this.r][this.c]=b?b:0,this.redraw(this.r),this._incCol()},_incCol:function(){this.c++,this.c>=this.maxCols&&(this.c=0,this._incRow())},_incRow:function(){this.r++,this.r>=this.maxLines&&(this._scrollLines(0,this.maxLines),this.r=this.maxLines-1)},_scrollLines:function(a,b){window.status="Scrolling lines ...",a++;for(var c=a;b>c;c++){var d=c-1;this.charBuf[d]=this.charBuf[c],this.styleBuf[d]=this.styleBuf[c]}var d=b-1;this.charBuf[d]=this.getRowArray(this.conf.cols,0),this.styleBuf[d]=this.getRowArray(this.conf.cols,0),this.redraw(d);for(var e=b-1;e>=a;e--)this.redraw(e-1);window.status=""},clear:function(){window.status="Clearing display ...",this.cursorOff(),this.insert=!1;for(var a=0;this.maxLines>a;a++)this.charBuf[a]=this.getRowArray(this.conf.cols,0),this.styleBuf[a]=this.getRowArray(this.conf.cols,0),this.redraw(a);this.r=0,this.c=0,window.status=""},reset:function(){this.lock||(this.lock=!0,this.rawMode=!1,this.charMode=!1,this.maxLines=this.conf.rows,this.maxCols=this.conf.cols,this.lastLine="",this.lineBuffer="",this.inputChar=0,this.clear())},prompt:function(){this.lock=!0,this.c>0&&this.newLine(),this.type(this.ps),this._charOut(1),this.lock=!1,this.cursorOn()},isPrintable:function(a,b){return this.wrapping&&4==this.globals.wrapChars[a]?!0:b&&a>255?a==this.termKey.EURO&&this.printEuro?!0:!1:a>=32&&a!=this.termKey.DEL||this.printTab&&a==this.termKey.TAB},cursorSet:function(a,b){var c=this.cursoractive;c&&this.cursorOff(),this.r=a%this.maxLines,this.c=b%this.maxCols,this._cursorReset(c)},cursorOn:function(){this.blinkTimer&&clearTimeout(this.blinkTimer),this.blinkBuffer=this.styleBuf[this.r][this.c],this._cursorBlink(),this.cursoractive=!0},cursorOff:function(){this.blinkTimer&&clearTimeout(this.blinkTimer),this.cursoractive&&(this.styleBuf[this.r][this.c]=this.blinkBuffer,this.redraw(this.r),this.cursoractive=!1)},cursorLeft:function(){var a=this.cursoractive;a&&this.cursorOff();var b=this.r,c=this.c;c>0?c--:b>0&&(c=this.maxCols-1,b--),this.isPrintable(this.charBuf[b][c])&&(this.r=b,this.c=c),this.insert=!0,this._cursorReset(a)},cursorRight:function(){var a=this.cursoractive;a&&this.cursorOff();var b=this.r,c=this.c;this.maxCols-1>c?c++:this.maxLines-1>b&&(c=0,b++),this.isPrintable(this.charBuf[b][c])||(this.insert=!1),this.isPrintable(this.charBuf[this.r][this.c])&&(this.r=b,this.c=c),this._cursorReset(a)},backspace:function(){var a=this.cursoractive;a&&this.cursorOff();var b=this.r,c=this.c;c>0?c--:b>0&&(c=this.maxCols-1,b--),this.isPrintable(this.charBuf[b][c])&&(this._scrollLeft(b,c),this.r=b,this.c=c),this._cursorReset(a)},fwdDelete:function(){var a=this.cursoractive;a&&this.cursorOff(),this.isPrintable(this.charBuf[this.r][this.c])&&(this._scrollLeft(this.r,this.c),this.isPrintable(this.charBuf[this.r][this.c])||(this.insert=!1)),this._cursorReset(a)},_cursorReset:function(a){a?this.cursorOn():this.blinkBuffer=this.styleBuf[this.r][this.c]},_cursorBlink:function(){this.blinkTimer&&clearTimeout(this.blinkTimer),this==this.globals.activeTerm&&(this.styleBuf[this.r][this.c]=this.crsrBlockMode?1&this.styleBuf[this.r][this.c]?254&this.styleBuf[this.r][this.c]:1|this.styleBuf[this.r][this.c]:2&this.styleBuf[this.r][this.c]?253&this.styleBuf[this.r][this.c]:2|this.styleBuf[this.r][this.c],this.redraw(this.r)),this.crsrBlinkMode&&(this.blinkTimer=setTimeout("Terminal.prototype.globals.activeTerm._cursorBlink()",this.blinkDelay))},_scrollLeft:function(a,b){var c=Array();for(c[0]=a;this.isPrintable(this.charBuf[a][b]);){var d=a,e=b+1;if(e==this.maxCols){if(!(this.maxLines-1>d))break;e=0,d++,c[c.length]=d}this.charBuf[a][b]=this.charBuf[d][e],this.styleBuf[a][b]=this.styleBuf[d][e],b=e,a=d}0!=this.charBuf[a][b]&&(this.charBuf[a][b]=0);for(var f=0;c.length>f;f++)this.redraw(c[f])},_scrollRight:function(a,b){var c=Array(),d=this._getLineEnd(a,b),e=d[0],f=d[1];if(f==this.maxCols-1&&e==this.maxLines-1){if(0==a)return;this._scrollLines(0,this.maxLines),this.r--,a--,e--}for(c[a]=1;this.isPrintable(this.charBuf[e][f]);){var g=e,h=f+1;if(h==this.maxCols&&(h=0,g++,c[g]=1),this.charBuf[g][h]=this.charBuf[e][f],this.styleBuf[g][h]=this.styleBuf[e][f],e==a&&f==b)break;f--,0>f&&(f=this.maxCols-1,e--,c[e]=1)}for(var i=a;this.maxLines>i;i++)c[i]&&this.redraw(i)},_getLineEnd:function(a,b){if(this.isPrintable(this.charBuf[a][b])||(b--,0>b&&(a>0?(a--,b=this.maxCols-1):b=0)),this.isPrintable(this.charBuf[a][b]))for(;;){var c=a,d=b+1;if(d==this.maxCols){if(!(this.maxLines-1>c))break;c++,d=0}if(!this.isPrintable(this.charBuf[c][d]))break;b=d,a=c}return[a,b]},_getLineStart:function(a,b){var c,d;if(!this.isPrintable(this.charBuf[a][b])){if(c=b-1,d=a,0>c){if(0==d)return[0,0];c=this.maxCols-1,d--}if(!this.isPrintable(this.charBuf[d][c]))return[a,b];a=d,b=c}for(;;){var d=a,c=b-1;if(0>c){if(0==d)break;c=this.maxCols-1,d--}if(!this.isPrintable(this.charBuf[d][c]))break;a=d,b=c}return[a,b]},_getLine:function(){for(var a=this._getLineEnd(this.r,this.c),b=a[0],c=a[1],d=Array();this.isPrintable(this.charBuf[b][c]);)if(d[d.length]=String.fromCharCode(this.charBuf[b][c]),c>0)c--;else{if(!(b>0))break;c=this.maxCols-1,b--}return d.reverse(),d.join("")},_clearLine:function(){for(var a=this._getLineEnd(this.r,this.c),b=a[0],c=a[1];this.isPrintable(this.charBuf[b][c]);)if(this.charBuf[b][c]=0,c>0)c--;else{if(!(b>0))break;this.redraw(b),c=this.maxCols-1,b--}b!=a[0]&&this.redraw(b),c++,this.cursorSet(b,c),this.insert=!1},backupScreen:function(){var a=this.backupBuffer=Object(),b=this.conf.rows,c=this.conf.cols;a.cbuf=Array(b),a.sbuf=Array(b),a.maxCols=this.maxCols,a.maxLines=this.maxLines,a.r=this.r,a.c=this.c,a.charMode=this.charMode,a.rawMode=this.rawMode,a.handler=this.handler,a.ctrlHandler=this.ctrlHandler,a.cursoractive=this.cursoractive,a.crsrBlinkMode=this.crsrBlinkMode,a.crsrBlockMode=this.crsrBlockMode,a.blinkDelay=this.blinkDelay,a.DELisBS=this.DELisBS,a.printTab=this.printTab,a.printEuro=this.printEuro,a.catchCtrlH=this.catchCtrlH,a.closeOnESC=this.closeOnESC,a.historyUnique=this.historyUnique,a.ps=this.ps,a.lineBuffer=this.lineBuffer,a.inputChar=this.inputChar,a.lastLine=this.lastLine,a.historyLength=this.history.length,a.histPtr=this.histPtr,a.wrapping=this.wrapping,a.mapANSI=this.mapANSI,a.ANSItrueBlack=this.ANSItrueBlack,this.cursoractive&&this.cursorOff();for(var d=0;b>d;d++)for(var e=this.charBuf[d],f=this.styleBuf[d],g=a.cbuf[d]=Array(c),h=a.sbuf[d]=Array(c),i=0;c>i;i++)g[i]=e[i],h[i]=f[i]},restoreScreen:function(){var a=this.backupBuffer;if(a){for(var b=this.conf.rows,c=0;b>c;c++)this.charBuf[c]=a.cbuf[c],this.styleBuf[c]=a.sbuf[c],this.redraw(c);this.maxCols=a.maxCols,this.maxLines=a.maxLines,this.r=a.r,this.c=a.c,this.charMode=a.charMode,this.rawMode=a.rawMode,this.handler=a.handler,this.ctrlHandler=a.ctrlHandler,this.cursoractive=a.cursoractive,this.crsrBlinkMode=a.crsrBlinkMode,this.crsrBlockMode=a.crsrBlockMode,this.blinkDelay=a.blinkDelay,this.DELisBS=a.DELisBS,this.printTab=a.printTab,this.printEuro=a.printEuro,this.catchCtrlH=a.catchCtrlH,this.closeOnESC=a.closeOnESC,this.historyUnique=a.historyUnique,this.ps=a.ps,this.lineBuffer=a.lineBuffer,this.inputChar=a.inputChar,this.lastLine=a.lastLine,this.history.length>a.historyLength&&(this.history.length=a.historyLength,this.histPtr=a.histPtr),this.wrapping=a.wrapping,this.mapANSI=a.mapANSI,this.ANSItrueBlack=a.ANSItrueBlack,this.cursoractive&&this.cursorOn(),this.backupBuffer=null}},swapBackup:function(){var a=this.backupBuffer;if(this.backupScreen,a){var b=this.backupBuffer;this.backupBuffer=a,this.restoreScreen(),this.backupBuffer=b}},escapeMarkup:function(a){return a.replace(/%/g,"%%")},focus:function(){this.globals.setFocus(this)},termKey:null,_makeTerm:function(a){window.status="Building terminal ...";var b=this.termDiv+"_r";if(this.domAPI){this.globals.hasSubDivs=!1;var c,d,e,f,g;c=document.createElement("div"),c.className="main",pli=document.createElement("div"),pli.setAttribute("id","container"),pli.style.backgroundColor=this.conf.frameColor,c.appendChild(pli),d=document.createElement("section"),d=document.createElement("section"),d.className="content",e=document.createElement("ul"),d.appendChild(e);for(var h="",i=0;this.conf.cols>i;i++)h+="&nbsp;";for(var j=0;this.conf.rows>j;j++)f=document.createElement("li"),f.id=b+j,f.className=this.conf.fontClass,f.innerHTML=h,e.appendChild(f);for(pli.appendChild(d),g=document.getElementById(this.termDiv);g.hasChildNodes();)g.removeChild(g.firstChild);g.appendChild(c)}else{this.globals.hasSubDivs=0>navigator.userAgent.indexOf("Gecko");var k="";k+='<table border="0" cellspacing="0" cellpadding="'+this.conf.frameWidth+'">\n',k+='<tr><td bgcolor="'+this.conf.frameColor+'"><table border="0" cellspacing="0" cellpadding="2"><tr><td  bgcolor="'+this.conf.bgColor+'"><table border="0" cellspacing="0" cellpadding="0">\n';for(var h="",i=0;this.conf.cols>i;i++)h+="&nbsp;";for(var j=0;this.conf.rows>j;j++){var l=this.globals.hasSubDivs?"":' id="'+b+'"';k+='<tr><td nowrap height="'+this.conf.rowHeight+'"'+l+' class="'+this.conf.fontClass+'">'+h+"</td></tr>\n"}k+="</table></td></tr>\n",k+="</table></td></tr>\n",k+="</table>\n";var m=2+this.conf.frameWidth;if(this.globals.hasSubDivs){for(var j=0;this.conf.rows>j;j++)k+='<div id="'+b+j+'" style="position:absolute; top:'+(m+j*this.conf.rowHeight)+"px; left: "+m+'px;" class="'+this.conf.fontClass+'"></div>\n';this.globals.termStringStart='<table border="0" cellspacing="0" cellpadding="0"><tr><td nowrap height="'+this.conf.rowHeight+'" class="'+this.conf.fontClass+'">',this.globals.termStringEnd="</td></tr></table>"}this.globals.writeElement(this.termDiv,k)}a||this.globals.setVisible(this.termDiv,1),window.status=""},rebuild:function(){for(var a=this.conf.rows,b=this.conf.cols,c=0;a>c;c++){var d=this.charBuf[c];if(d){if(b>d.length)for(var e=d.length;b>e;e++)this.charBuf[c][e]=0,this.styleBuf[c][e]=0}else this.charBuf[c]=this.getRowArray(b,0),this.styleBuf[c]=this.getRowArray(b,0)}var f=!1;this.r>=a&&(c=a-1,f=!0),this.c>=b&&(e=b-1,f=!0),f&&this.cursoractive&&this.cursorOn(),this._makeTerm(!0);for(var c=0;a>c;c++)this.redraw(c);this.backupBuffer=null},moveTo:function(a,b){this.globals.setElementXY(this.termDiv,a,b)},resizeTo:function(a,b){return this.termDivReady()?(a=parseInt(a,10),b=parseInt(b,10),isNaN(a)||isNaN(b)||4>a||2>b?!1:(this.maxCols=this.conf.cols=a,this.maxLines=this.conf.rows=b,this._makeTerm(),this.clear(),!0)):!1},redraw:function(a){for(var m,b=this.globals.termStringStart,c=0,d=this.globals.termStyles,e=this.globals.termStyleClose,f=this.globals.termStyleOpen,g=this.globals.termSpecials,h=this.globals.colorCodes,i=this.globals.nsColorCodes,j=this.globals.webColorCodes,k=this.charBuf,l=this.styleBuf,n=0;this.conf.cols>n;n++){var o=k[a][n],p=l[a][n];if(p!=c){if(c){16776960&c&&(b+="</span>");for(var q=d.length-1;q>=0;q--){var r=d[q];c&r&&(b+=e[r])}}c=p;for(var q=0;d.length>q;q++){var r=d[q];c&r&&(b+=f[r])}if(m="",65280&c){var s=(65280&c)>>>8;m=16>s?h[s]:"#"+i[s-16]}else 16711680&c&&(m="#"+j[(16711680&c)>>>16]);m&&(b+=1&c?'<span style="background-color:'+m+' !important;">':'<span style="color:'+m+' !important;">')}b+=g[o]?g[o]:String.fromCharCode(o)}if(c>0){16776960&c&&(b+="</span>");for(var q=d.length-1;q>=0;q--){var r=d[q];c&r&&(b+=e[r])}}b+=this.globals.termStringEnd,this.globals.writeElement(this.termDiv+"_r"+a,b)},guiReady:function(){var a=!0;if(this.globals.guiElementsReady(this.termDiv)){for(var b=0;this.conf.rows>b;b++)if(0==this.globals.guiElementsReady(this.termDiv+"_r"+b)){a=!1;break}}else a=!1;return a},termDivReady:function(){return document.getElementById?document.getElementById(this.termDiv)?!0:!1:document.all?document.all[this.termDiv]?!0:!1:!1},getDimensions:function(){var a=0,b=0,c=this.termDiv;if(document.getElementById){var d=document.getElementById(c);d&&d.firstChild?(a=parseInt(d.firstChild.offsetWidth,10),b=parseInt(d.firstChild.offsetHeight,10)):d&&d.children&&d.children[0]&&(a=parseInt(d.children[0].offsetWidth,10),b=parseInt(d.children[0].offsetHeight,10))}else if(document.all){var d=document.all[c];d&&d.children&&d.children[0]&&(a=parseInt(d.children[0].offsetWidth,10),b=parseInt(d.children[0].offsetHeight,10))}return{width:a,height:b}},globals:{termToInitialze:null,activeTerm:null,kbdEnabled:!1,keylock:!1,keyRepeatDelay1:450,keyRepeatDelay2:100,keyRepeatTimer:null,lcMorePrompt1:" -- MORE -- ",lcMorePromtp1Style:1,lcMorePrompt2:" (Type: space to continue, 'q' to quit)",lcMorePrompt2Style:0,lcMoreKeyAbort:113,lcMoreKeyContinue:32,_initGlobals:function(){var a=Terminal.prototype.globals;a._extendMissingStringMethods(),a._initWebColors(),a._initDomKeyRef(),Terminal.prototype.termKey=a.termKey},getHexChar:function(a){var b=Terminal.prototype.globals;return b.isHexChar(a)?b.hexToNum[a]:-1},isHexChar:function(a){return a>="0"&&"9">=a||a>="a"&&"f">=a||a>="A"&&"F">=a?!0:!1},isHexOnlyChar:function(a){return a>="a"&&"f">=a||a>="A"&&"F">=a?!0:!1},hexToNum:{0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,b:11,c:12,d:13,e:14,f:15,A:10,B:11,C:12,D:13,E:14,F:15},webColors:[],webColorCodes:[""],colors:{black:1,red:2,green:3,yellow:4,blue:5,magenta:6,cyan:7,white:8,grey:9,red2:10,green2:11,yellow2:12,blue2:13,magenta2:14,cyan2:15,red1:2,green1:3,yellow1:4,blue1:5,magenta1:6,cyan1:7,gray:9,darkred:10,darkgreen:11,darkyellow:12,darkblue:13,darkmagenta:14,darkcyan:15,"default":0,clear:0},colorCodes:["","#000000","#ff0000","#00ff00","#ffff00","#0066ff","#ff00ff","#00ffff","#ffffff","#808080","#990000","#009900","#999900","#003399","#990099","#009999"],nsColors:{aliceblue:1,antiquewhite:2,aqua:3,aquamarine:4,azure:5,beige:6,black:7,blue:8,blueviolet:9,brown:10,burlywood:11,cadetblue:12,chartreuse:13,chocolate:14,coral:15,cornflowerblue:16,cornsilk:17,crimson:18,darkblue:19,darkcyan:20,darkgoldenrod:21,darkgray:22,darkgreen:23,darkkhaki:24,darkmagenta:25,darkolivegreen:26,darkorange:27,darkorchid:28,darkred:29,darksalmon:30,darkseagreen:31,darkslateblue:32,darkslategray:33,darkturquoise:34,darkviolet:35,deeppink:36,deepskyblue:37,dimgray:38,dodgerblue:39,firebrick:40,floralwhite:41,forestgreen:42,fuchsia:43,gainsboro:44,ghostwhite:45,gold:46,goldenrod:47,gray:48,green:49,greenyellow:50,honeydew:51,hotpink:52,indianred:53,indigo:54,ivory:55,khaki:56,lavender:57,lavenderblush:58,lawngreen:59,lemonchiffon:60,lightblue:61,lightcoral:62,lightcyan:63,lightgoldenrodyellow:64,lightgreen:65,lightgrey:66,lightpink:67,lightsalmon:68,lightseagreen:69,lightskyblue:70,lightslategray:71,lightsteelblue:72,lightyellow:73,lime:74,limegreen:75,linen:76,maroon:77,mediumaquamarine:78,mediumblue:79,mediumorchid:80,mediumpurple:81,mediumseagreen:82,mediumslateblue:83,mediumspringgreen:84,mediumturquoise:85,mediumvioletred:86,midnightblue:87,mintcream:88,mistyrose:89,moccasin:90,navajowhite:91,navy:92,oldlace:93,olive:94,olivedrab:95,orange:96,orangered:97,orchid:98,palegoldenrod:99,palegreen:100,paleturquoise:101,palevioletred:102,papayawhip:103,peachpuff:104,peru:105,pink:106,plum:107,powderblue:108,purple:109,red:110,rosybrown:111,royalblue:112,saddlebrown:113,salmon:114,sandybrown:115,seagreen:116,seashell:117,sienna:118,silver:119,skyblue:120,slateblue:121,slategray:122,snow:123,springgreen:124,steelblue:125,tan:126,teal:127,thistle:128,tomato:129,turquoise:130,violet:131,wheat:132,white:133,whitesmoke:134,yellow:135,yellowgreen:136},nsColorCodes:["","f0f8ff","faebd7","00ffff","7fffd4","f0ffff","f5f5dc","000000","0000ff","8a2be2","a52a2a","deb887","5f9ea0","7fff00","d2691e","ff7f50","6495ed","fff8dc","dc143c","00008b","008b8b","b8860b","a9a9a9","006400","bdb76b","8b008b","556b2f","ff8c00","9932cc","8b0000","e9967a","8fbc8f","483d8b","2f4f4f","00ced1","9400d3","ff1493","00bfff","696969","1e90ff","b22222","fffaf0","228b22","ff00ff","dcdcdc","f8f8ff","ffd700","daa520","808080","008000","adff2f","f0fff0","ff69b4","cd5c5c","4b0082","fffff0","f0e68c","e6e6fa","fff0f5","7cfc00","fffacd","add8e6","f08080","e0ffff","fafad2","90ee90","d3d3d3","ffb6c1","ffa07a","20b2aa","87cefa","778899","b0c4de","ffffe0","00ff00","32cd32","faf0e6","800000","66cdaa","0000cd","ba55d3","9370db","3cb371","7b68ee","00fa9a","48d1cc","c71585","191970","f5fffa","ffe4e1","ffe4b5","ffdead","000080","fdf5e6","808000","6b8e23","ffa500","ff4500","da70d6","eee8aa","98fb98","afeeee","db7093","ffefd5","ffdab9","cd853f","ffc0cb","dda0dd","b0e0e6","800080","ff0000","bc8f8f","4169e1","8b4513","fa8072","f4a460","2e8b57","fff5ee","a0522d","c0c0c0","87ceeb","6a5acd","708090","fffafa","00ff7f","4682b4","d2b48c","008080","d8bfd8","ff6347","40e0d0","ee82ee","f5deb3","ffffff","f5f5f5","ffff00","9acd32"],_webSwatchChars:["0","3","6","9","c","f"],_initWebColors:function(){var a=Terminal.prototype.globals;a._webColorSwatch;for(var f,g,h,i,j,k,l,c=a.webColors,d=a.webColorCodes,e=1,m=0;6>m;m++){f=a._webSwatchChars[m],i=f+f;for(var n=0;6>n;n++){g=a._webSwatchChars[n],j=i+g+g,k=f+g;for(var o=0;6>o;o++)h=a._webSwatchChars[o],l=j+h+h,c[k+h]=c[l]=e,d[e]=l,e++}}},webifyColor:function(a){var b=Terminal.prototype.globals;if(6==a.length){for(var c="",d=0;6>d;d+=2){var e=a.charAt(d),f=a.charAt(d+1);if(!b.isHexChar(e)||!b.isHexChar(f))return"";c+=b._webSwatchChars[Math.round(5*(parseInt(e+f,16)/255))]}return c}if(3==a.length){for(var c="",d=0;3>d;d++){var e=a.charAt(d);if(!b.isHexChar(e))return"";c+=b._webSwatchChars[Math.round(5*(parseInt(e,16)/15))]}return c}return""},setColor:function(a,b){var c=Terminal.prototype.globals;if("number"==typeof a&&a>=1&&15>=a)c.colorCodes[a]=b;else if("string"==typeof a)if(a=a.toLowerCase(),1==a.length&&c.isHexChar(a)){var d=c.hexToNum[a];d&&(c.colorCodes[d]=b)}else if(c.colors[a]!==void 0){var d=c.colors[a];d&&(c.colorCodes[d]=b)}},getColorString:function(a){var b=Terminal.prototype.globals;if("number"==typeof a&&a>=0&&15>=a)return b.colorCodes[a];if("string"==typeof a){if(a=a.toLowerCase(),1==a.length&&b.isHexChar(a))return b.colorCodes[b.hexToNum[a]];if(b.colors[a]!==void 0)return b.colorCodes[b.colors[a]]}return""},getColorCode:function(a){var b=Terminal.prototype.globals;if("number"==typeof a&&a>=0&&15>=a)return a;if("string"==typeof a){if(a=a.toLowerCase(),1==a.length&&b.isHexChar(a))return parseInt(a,16);if(b.colors[a]!==void 0)return b.colors[a]}return 0},insertText:function(a){var b=Terminal.prototype.globals,c=b.activeTerm;if(!c||c.closed||b.keylock||c.lock||c.charMode)return!1;for(var d=0;a.length>d;d++)b.keyHandler({which:a.charCodeAt(d),_remapped:!0});return!0},importEachLine:function(a){var b=Terminal.prototype.globals,c=b.activeTerm;if(!c||c.closed||b.keylock||c.lock||c.charMode)return!1;c.cursorOff(),c._clearLine(),a=a.replace(/\r\n?/g,"\n");for(var d=a.split("\n"),e=0;d.length>e;e++){for(var f=0;d[e].length>f;f++)b.keyHandler({which:d[e].charCodeAt(f),_remapped:!0});b.keyHandler({which:term.termKey.CR,_remapped:!0})}return!0},importMultiLine:function(a){var b=Terminal.prototype.globals,c=b.activeTerm;if(!c||c.closed||b.keylock||c.lock||c.charMode)return!1;c.lock=!0,c.cursorOff(),c._clearLine(),a=a.replace(/\r\n?/g,"\n");for(var d=a.split("\n"),e=0;d.length>e;e++)c.type(d[e]),d.length-1>e&&c.newLine();return c.lineBuffer=a,c.lastLine="",c.inputChar=0,c.handler(),!0},normalize:function(a,b){for(var c=""+a;b>c.length;)c="0"+c;return c},fillLeft:function(a,b){for("string"!=typeof a&&(a=""+a);b>a.length;)a=" "+a;return a},center:function(a,b){for(var c="",d=a.length;b>d;d+=2)c+=" ";return c+a},stringReplace:function(a,b,c){for(var d=a.length,e=b.length,f=c.indexOf(a);f>=0;)c=c.substring(0,f)+b+c.substring(f+d),f=c.indexOf(a,f+e);return c},wrapChars:{9:1,10:1,12:4,13:1,32:1,40:3,45:2,61:2,91:3,94:3,123:3},setFocus:function(a){Terminal.prototype.globals.activeTerm=a,Terminal.prototype.globals.clearRepeatTimer()},termKey:{NUL:0,SOH:1,STX:2,ETX:3,EOT:4,ENQ:5,ACK:6,BEL:7,BS:8,BACKSPACE:8,HT:9,TAB:9,LF:10,VT:11,FF:12,CR:13,SO:14,SI:15,DLE:16,DC1:17,DC2:18,DC3:19,DC4:20,NAK:21,SYN:22,ETB:23,CAN:24,EM:25,SUB:26,ESC:27,IS4:28,IS3:29,IS2:30,IS1:31,DEL:127,EURO:8364,LEFT:28,RIGHT:29,UP:30,DOWN:31},termDomKeyRef:{},_domKeyMappingData:{LEFT:"LEFT",RIGHT:"RIGHT",UP:"UP",DOWN:"DOWN",BACK_SPACE:"BS",RETURN:"CR",ENTER:"CR",ESCAPE:"ESC",DELETE:"DEL",TAB:"TAB"},_initDomKeyRef:function(){var a=Terminal.prototype.globals,b=a._domKeyMappingData,c=a.termDomKeyRef,d=a.termKey;for(var e in b)c["DOM_VK_"+e]=d[b[e]]},registerEvent:function(a,b,c,d){if(a.addEventListener)a.addEventListener(b.toLowerCase(),c,d);else{var e=b.toUpperCase();window.Event&&window.Event[e]&&a.captureEvents&&a.captureEvents(Event[e]),a["on"+b.toLowerCase()]=c}},releaseEvent:function(a,b,c,d){if(a.removeEventListener)a.removeEventListener(b.toLowerCase(),c,d);else{var e=b.toUpperCase();window.Event&&window.Event[e]&&a.releaseEvents&&a.releaseEvents(Event[e]),e="on"+b.toLowerCase(),a[e]&&a[e]==c&&(a.et=null)}},enableKeyboard:function(a){var b=Terminal.prototype.globals;b.kbdEnabled||(b.registerEvent(document,"keypress",b.keyHandler,!0),b.registerEvent(document,"keydown",b.keyFix,!0),b.registerEvent(document,"keyup",b.clearRepeatTimer,!0),b.kbdEnabled=!0),b.activeTerm=a},disableKeyboard:function(){var b=Terminal.prototype.globals;b.kbdEnabled&&(b.releaseEvent(document,"keypress",b.keyHandler,!0),b.releaseEvent(document,"keydown",b.keyFix,!0),b.releaseEvent(document,"keyup",b.clearRepeatTimer,!0),b.kbdEnabled=!1),b.activeTerm=null},keyFix:function(a){var d,b=Terminal.prototype.globals,c=b.activeTerm;if(b.keylock||c.lock)return!0;if(window.event){if(a||(a=window.event),d=a.keyCode,a.DOM_VK_UP){for(var e in b.termDomKeyRef)if(a[e]&&d==a[e])return b.keyHandler({which:b.termDomKeyRef[e],_remapped:!0,_repeat:27==d?!0:!1}),a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0,!1;
return a.cancelBubble=!1,!0}var f=c.termKey,g=b.keyHandler;if(8!=d||c.isOpera)if(9==d)g({which:f.TAB,_remapped:!0,_repeat:c.printTab?!1:!0});else if(27==d)g({which:f.ESC,_remapped:!0,_repeat:c.printTab?!1:!0});else if(37==d)g({which:f.LEFT,_remapped:!0,_repeat:!0});else if(39==d)g({which:f.RIGHT,_remapped:!0,_repeat:!0});else if(38==d)g({which:f.UP,_remapped:!0,_repeat:!0});else if(40==d)g({which:f.DOWN,_remapped:!0,_repeat:!0});else if(127==d||46==d)g({which:f.DEL,_remapped:!0,_repeat:!0});else{if(!(d>=57373&&57376>=d))return a.cancelBubble=!1,!0;57373==d?g({which:f.UP,_remapped:!0,_repeat:!0}):57374==d?g({which:f.DOWN,_remapped:!0,_repeat:!0}):57375==d?g({which:f.LEFT,_remapped:!0,_repeat:!0}):57376==d&&g({which:f.RIGHT,_remapped:!0,_repeat:!0})}else g({which:f.BS,_remapped:!0,_repeat:!0});return a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0,!1}},clearRepeatTimer:function(){var b=Terminal.prototype.globals;b.keyRepeatTimer&&(clearTimeout(b.keyRepeatTimer),b.keyRepeatTimer=null)},doKeyRepeat:function(a){Terminal.prototype.globals.keyHandler({which:a,_remapped:!0,_repeated:!0})},keyHandler:function(a){var b=Terminal.prototype.globals,c=b.activeTerm;if(b.keylock||c.lock||c.isMac&&a&&a.metaKey)return!0;window.event?(window.event.preventDefault&&window.event.preventDefault(),window.event.stopPropagation&&window.event.stopPropagation()):a&&(a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation());var d,e=!1,f=!1,g=!1,h=c.termKey,i=0;if(a)d=a.which,e=a.ctrlKey&&a.altKey||2==a.modifiers,f=a.shiftKey||4==a.modifiers,a._remapped&&(g=!0,window.event&&(e=e||window.event.ctrlKey&&!window.event.altKey,f=f||window.event.shiftKey)),a._repeated?i=2:a._repeat&&(i=1);else{if(!window.event)return!0;d=window.event.keyCode,e=window.event.ctrlKey&&!window.event.altKey,f=window.event.shiftKey,window.event._repeated?i=2:window.event._repeat&&(i=1)}if(""==d&&0==g&&(null==a&&(a=window.event),0==a.charCode&&a.keyCode))if(a.DOM_VK_UP){var j=b.termDomKeyRef;for(var k in j)if(a[k]&&a.keyCode==a[k]){d=j[k];break}}else 28==a.keyCode?d=h.LEFT:29==a.keyCode?d=h.RIGHT:30==a.keyCode?d=h.UP:31==a.keyCode?d=h.DOWN:37==a.keyCode?d=h.LEFT:39==a.keyCode?d=h.RIGHT:38==a.keyCode?d=h.UP:40==a.keyCode?d=h.DOWN:9==a.keyCode&&(d=h.TAB);if(!(d>=57344&&63743>=d)){if(i&&(b.clearRepeatTimer(),b.keyRepeatTimer=window.setTimeout("Terminal.prototype.globals.doKeyRepeat("+d+")",1==i?b.keyRepeatDelay1:b.keyRepeatDelay2)),c.charMode)return c.insert=!1,c.inputChar=d,c.lineBuffer="",c.handler(),32>=d&&window.event&&(window.event.cancelBubble=!0),!1;if(!e){if(d==h.CR)return c.lock=!0,c.cursorOff(),c.insert=!1,c.rawMode?c.lineBuffer=c.lastLine:(c.lineBuffer=c._getLine(),""==c.lineBuffer||c.historyUnique&&0!=c.history.length&&c.lineBuffer==c.history[c.history.length-1]||(c.history[c.history.length]=c.lineBuffer),c.histPtr=c.history.length),c.lastLine="",c.inputChar=0,c.handler(),window.event&&(window.event.cancelBubble=!0),!1;if(d==h.ESC&&c.conf.closeOnESC)return c.close(),window.event&&(window.event.cancelBubble=!0),!1;if(32>d&&c.rawMode)return window.event&&(window.event.cancelBubble=!0),!1;if(d==h.LEFT)return c.cursorLeft(),window.event&&(window.event.cancelBubble=!0),!1;if(d==h.RIGHT)return c.cursorRight(),window.event&&(window.event.cancelBubble=!0),!1;if(d==h.UP)return c.cursorOff(),c.histPtr==c.history.length&&(c.lastLine=c._getLine()),c._clearLine(),c.history.length&&c.histPtr>=0?(c.histPtr>0&&c.histPtr--,c.type(c.history[c.histPtr])):c.lastLine&&c.type(c.lastLine),c.cursorOn(),window.event&&(window.event.cancelBubble=!0),!1;if(d==h.DOWN)return c.cursorOff(),c.histPtr==c.history.length&&(c.lastLine=c._getLine()),c._clearLine(),c.history.length&&c.histPtr<=c.history.length?(c.histPtr<c.history.length&&c.histPtr++,c.histPtr<c.history.length?c.type(c.history[c.histPtr]):c.lastLine&&c.type(c.lastLine)):c.lastLine&&c.type(c.lastLine),c.cursorOn(),window.event&&(window.event.cancelBubble=!0),!1;if(d==h.BS)return c.backspace(),window.event&&(window.event.cancelBubble=!0),!1;if(d==h.DEL)return c.DELisBS?c.backspace():c.fwdDelete(),window.event&&(window.event.cancelBubble=!0),!1}return c.rawMode?(c.isPrintable(d)&&(c.lastLine+=String.fromCharCode(d)),32==d&&window.event?window.event.cancelBubble=!0:window.opera&&window.event&&(window.event.cancelBubble=!0),!1):c.conf.catchCtrlH&&(d==h.BS||e&&72==d)?(c.backspace(),window.event&&(window.event.cancelBubble=!0),!1):c.ctrlHandler&&(32>d||e&&c.isPrintable(d,!0))?((d>=65&&96>=d||63==d)&&(63==d?d=31:d-=64),c.inputChar=d,c.ctrlHandler(),window.event&&(window.event.cancelBubble=!0),!1):e||!c.isPrintable(d,!0)?(window.event&&(window.event.cancelBubble=!0),!1):c.isPrintable(d,!0)?(c.blinkTimer&&clearTimeout(c.blinkTimer),c.insert&&(c.cursorOff(),c._scrollRight(c.r,c.c)),c._charOut(d),c.cursorOn(),32==d&&window.event?window.event.cancelBubble=!0:window.opera&&window.event&&(window.event.cancelBubble=!0),!1):!0}},hasSubDivs:!1,termStringStart:"",termStringEnd:"",termSpecials:{0:"&nbsp;",1:"&nbsp;",9:"&nbsp;",32:"&nbsp;",34:"&quot;",38:"&amp;",60:"&lt;",62:"&gt;",127:"&loz;",8364:"&euro;"},termStyles:[1,2,4,8,16],termStyleMarkup:{r:1,u:2,i:4,s:8,b:16},termStyleOpen:{1:'<span class="termReverse">',2:"<u>",4:"<i>",8:"<strike>",16:"<i>"},termStyleClose:{1:"</span>",2:"</u>",4:"</i>",8:"</strike>",16:"</i>"},assignStyle:function(a,b,c,d){var e=Terminal.prototype.globals;if((!a||isNaN(a))&&a>=256)return alert("termlib.js:\nCould not assign style.\n"+f+" is not a valid power of 2 between 0 and 256."),void 0;for(var f=255&a,g=!1,h=0;8>h;h++)if(1&f>>>h){if(g)return alert("termlib.js:\nCould not assign style code.\n"+f+" is not a power of 2!"),void 0;g=!0}if(!g)return alert("termlib.js:\nCould not assign style code.\n"+f+" is not a valid power of 2 between 0 and 256."),void 0;if(b=(b+"").toLowerCase(),"c"==b||"p"==b)return alert('termlib.js:\nCould not assign mark up.\n"'+b+'" is a reserved code.'),void 0;if(b.length>1)return alert('termlib.js:\nCould not assign mark up.\n"'+b+'" is not a single letter code.'),void 0;for(var i=!1,h=0;e.termStyles.length>h;h++)if(e.termStyles[h]==f){i=!0;break}if(i){var j=e.termStyleMarkup[b];if(j&&j!=f)return alert('termlib.js:\nCould not assign mark up.\n"'+b+'" is already in use.'),void 0}else{if(e.termStyleMarkup[b])return alert('termlib.js:\nCould not assign mark up.\n"'+b+'" is already in use.'),void 0;e.termStyles[e.termStyles.length]=f}e.termStyleMarkup[b]=f,e.termStyleOpen[f]=c,e.termStyleClose[f]=d},ANSI_regexp:/(\x1b\[|x9b)([0-9;]+?)([a-zA-Z])/g,ANIS_SGR_codes:{0:"%+p",1:"%+b",3:"%+i",4:"%+u",7:"%+r",9:"%+s",21:"%+u",22:"%-b",23:"%-i",24:"%-u",27:"%-r",29:"%-s",30:"%c(0)",31:"%c(a)",32:"%c(b)",33:"%c(c)",34:"%c(d)",35:"%c(e)",36:"%c(f)",37:"%c(#999)",39:"%c(0)",90:"%c(9)",91:"%c(2)",92:"%c(3)",93:"%c(4)",94:"%c(5)",95:"%c(6)",96:"%c(7)",97:"%c(8)",99:"%c(0)",trueBlack:"%c(1)"},ANSI_map:function(a,b){var c=Terminal.prototype.globals;return c.ANSI_regexp.lastIndex=0,a.replace(c.ANSI_regexp,function(a,d,e,f){return c.ANSI_replace(e,f,b)})},ANSI_replace:function(a,b,c){var d=Terminal.prototype.globals;if("m"==b){if(""==a)return d.ANIS_SGR_codes[0];if(c&&"30"==a)return d.ANIS_SGR_codes.trueBlack;if(d.ANIS_SGR_codes[a])return d.ANIS_SGR_codes[a]}return""},writeElement:function(a,b){if(document.getElementById){var c=document.getElementById(a);c.innerHTML=b}else document.all&&(document.all[a].innerHTML=b)},setElementXY:function(a,b,c){if(document.getElementById){var d=document.getElementById(a);d.style.left=b+"px",d.style.top=c+"px"}else document.all&&(document.all[a].style.left=b+"px",document.all[a].style.top=c+"px")},setVisible:function(a,b){if(document.getElementById){var c=document.getElementById(a);c.style.visibility=b?"visible":"hidden"}else document.all&&(document.all[a].style.visibility=b?"visible":"hidden")},setDisplay:function(a,b){if(document.getElementById){var c=document.getElementById(a);c.style.display=b}else document.all&&(document.all[a].style.display=b)},guiElementsReady:function(a){return document.getElementById?document.getElementById(a)?!0:!1:document.all?document.all[a]?!0:!1:!1},_termString_makeKeyref:function(){for(var a=Terminal.prototype.globals,b=a.termString_keyref=Array(),c=a.termString_keycoderef=Array(),d=Array("A","B","C","D","E","F"),e=0;15>=e;e++)for(var f=10>e?e:d[e-10],g=0;15>=g;g++){var h=10>g?g:d[g-10],i=16*e+g;if(i>=32){var j=unescape("%"+f+h);b[i]=j,c[j]=i}}},_extendMissingStringMethods:function(){String.fromCharCode&&String.prototype.charCodeAt||Terminal.prototype.globals._termString_makeKeyref(),String.fromCharCode||(String.fromCharCode=function(a){return null!=a?Terminal.prototype.globals.termString_keyref[a]:""}),String.prototype.charCodeAt||(String.prototype.charCodeAt=function(a){return cs=this.charAt(a),Terminal.prototype.globals.termString_keycoderef[cs]?Terminal.prototype.globals.termString_keycoderef[cs]:0})}}},Terminal.prototype.globals._initGlobals();var TerminalDefaults=Terminal.prototype.Defaults,termDefaultHandler=Terminal.prototype.defaultHandler,TermGlobals=Terminal.prototype.globals,termKey=Terminal.prototype.globals.termKey,termDomKeyRef=Terminal.prototype.globals.termDomKeyRef;Terminal.prototype._HttpSocket=function(){var a=null;if(window.XMLHttpRequest)try{a=new XMLHttpRequest}catch(b){}else if(window.ActiveXObject)for(var c=this._msXMLHttpObjects,d=0;c.length>d;d++)try{if(a=new ActiveXObject(c[d])){c.length>1&&(this.prototype._msXMLHttpObjects=[c[d]]);break}}catch(b){}this.request=a,this.url,this.data=null,this.query="",this.timeoutTimer=null,this.localMode=Boolean(0==window.location.href.search(/^file:/i)),this.error=0},Terminal.prototype._HttpSocket.prototype={version:"1.02",useXMLEncoding:!1,defaulTimeout:1e4,defaultMethod:"GET",forceNewline:!0,errno:{OK:0,NOTIMPLEMENTED:1,FATALERROR:2,TIMEOUT:3,NETWORKERROR:4,LOCALFILEERROR:5},errstring:["","XMLHttpRequest not implemented.","Could not open XMLHttpRequest.","The connection timed out.","Network error.","The requested local document was not found."],_msXMLHttpObjects:["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.5.0","Msxml2.XMLHTTP.4.0","Msxml2.XMLHTTP.3.0"],serializeData:function(){this.query=this.serialize(this.data)},serialize:function(a){var b="";if(null!=a)switch(typeof a){case"object":var c=[];if(a instanceof Array){for(var d=0;a.length>d;d++)c.push(this.serialize(a[d]));b=c.join(",");break}for(var d in a)switch(typeof a[d]){case"object":c.push(encodeURIComponent(d)+"="+this.serialize(a[d]));break;default:c.push(encodeURIComponent(d)+"="+encodeURIComponent(a[d]))}b=this.useXMLEncoding?c.join(";"):c.join("&");break;case"number":b=a+"";break;case"string":b=encodeURIComponent(a);break;case"boolean":b=a?"1":"0"}return b},toCamelCase:function(a){"string"!=typeof a&&(a+="");for(var b=a.toLowerCase().split("-"),c=b[0],d=1;b.length>d;d++)p=b[d],p.length&&(c+=p.charAt(0).toUpperCase()+p.substring(1));return c},callbackHandler:function(){if(!this.termRef.closed){var a=this.request;if(0!=this.error||4==a.readyState){this.timeoutTimer&&(clearTimeout(this.timeoutTimer),this.timeoutTimer=null);var b=!1,c=!0,d={headers:{},ErrorCodes:this.errno};if(this.localMode)this.error&&this.error<this.errno.NETWORKERROR?(d.status=0,d.statusText="Connection Error",d.responseText="",d.responseXML=null):this.error||null==a.responseText?(c=!1,d.status=404,d.statusText="Not Found",d.responseText="The document "+this.url+" was not found on this file system.",d.responseXML=null,this.error=this.errno.LOCALFILEERROR):(b=!0,c=!1,d.status=200,d.statusText="OK",d.responseText=a.responseText,d.responseXML=a.responseXML);else{try{this.error||"object"==typeof a&&void 0!=a.status&&(c=!1,a.status>=200&&300>a.status?b=!0:a.status>=12e3&&(c=!0,this.error=this.errno.NETWORKERROR))}catch(e){}if(c)d.status=0,d.statusText="Connection Error",d.responseText="",d.responseXML=null;else if(d.status=a.status,d.statusText=404==a.status?"Not Found":a.statusText,d.responseText=a.responseText,d.responseXML=a.responseXML,this.getHeaders)if(this.getHeaders instanceof Array)for(var f=0;this.getHeaders.length>f;f++){var g=this.getHeaders[f];try{d.headers[this.toCamelCase(g)]=a.getResponseHeader(g)}catch(e){}}else for(var g in this.getHeaders)try{d.headers[this.toCamelCase(g)]=a.getResponseHeader(g)}catch(e){}}this.forceNewline&&(d.responseText=d.responseText.replace(/\r\n?/g,"\n")),d.url=this.url,d.data=this.data,d.query=this.query,d.method=this.method,d.success=b,d.errno=this.error,d.errstring=this.errstring[this.error];var h=this.termRef;h.socket=d,this.callback?"function"==typeof this.callback?this.callback.apply(h):window[this.callback]&&"function"==typeof window[this.callback]?window[this.callback].apply(h):h._defaultServerCallback():h._defaultServerCallback(),delete h.socket,this.request=null,this.callback=null}}},timeoutHandler:function(){this.error=this.errno.TIMEOUT;try{this.request.abort()}catch(a){}this.localMode||this.callbackHandler()}},Terminal.prototype.send=function(a){var b=new this._HttpSocket;if(a){if("string"==typeof a.method)switch(a.method.toLowerCase()){case"post":b.method="POST";break;case"get":b.method="GET";break;default:b.method=b.defaultMethod.toUpperCase()}else b.method=b.defaultMethod;void 0!=a.postbody?(b.method="POST",b.query=a.postbody,b.data=a.data):void 0!=a.data&&(b.data=a.data,b.serializeData()),a.url&&(b.url=a.url),a.getHeaders&&"object"==typeof a.getHeaders&&(b.getHeaders=a.getHeaders)}else a={},b.method=b.defaultMethod;var c=b.url;if("GET"==b.method&&(b.query&&(c+=0>c.indexOf("?")?"?"+b.query:b.useXMLEncoding?";"+b.query:"&"+b.query),!b.localMode)){var d="_termlib_reqid="+(new Date).getTime()+"_"+Math.floor(1e5*Math.random());c+=0>c.indexOf("?")?"?"+d:b.useXMLEncoding?";"+d:"&"+d}if(b.callback=a.callback,b.termRef=this,!b.request)return b.error=b.errno.NOTIMPLEMENTED,b.callbackHandler(),void 0;try{void 0!=a.userid?void 0!=a.password?b.request.open(b.method,c,!0,a.userid,a.password):b.request.open(b.method,c,!0,a.userid):b.request.open(b.method,c,!0)}catch(e){return b.error=b.errno.FATALERROR,b.callbackHandler(),void 0}var f=null;if("POST"==b.method){try{b.request.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}catch(e){}f=b.query}if(a.headers&&"objects"==typeof a.headers)for(var g in a.headers)try{b.request.setRequestHeader(g,a.headers[g])}catch(e){}if(a.mimetype&&b.request.overrideMimeType)try{b.request.overrideMimeType(a.mimetype),b.request.setRequestHeader("Connection","close")}catch(e){}var h=a.timeout&&"number"==typeof a.timeout?a.tiomeout:b.defaulTimeout;b.request.onreadystatechange=function(){b.callbackHandler()};try{b.request.send(f)}catch(e){if(b.localMode)b.request.onreadystatechange=null,b.request.abort(),b.error=b.errno.LOCALFILEERROR;else{b.request.onreadystatechange=null;try{b.request.abort()}catch(i){}b.error=b.errno.NETWORKERROR}return b.callbackHandler(),!0}b.timeoutTimer=setTimeout(function(){b.timeoutHandler()},h)},Terminal.prototype._defaultServerCallback=function(){if(this.socket.success)this.write("Server Response:%n"+this.socket.responseText,!0);else{var a="Request failed: "+this.socket.status+" "+this.socket.statusText;this.socket.errno&&(a+="%n"+this.socket.errstring),this.write(a),this.prompt()}},ElizaBot.prototype.reset=function(){this.quit=!1,this.mem=[],this.lastchoice=[];for(var a=0;elizaKeywords.length>a;a++){this.lastchoice[a]=[];for(var b=elizaKeywords[a][2],c=0;b.length>c;c++)this.lastchoice[a][c]=-1}},ElizaBot.prototype._dataParsed=!1,ElizaBot.prototype._init=function(){var a=ElizaBot.prototype.global=self,b={};if(a.elizaSynons&&"object"==typeof elizaSynons)for(var c in elizaSynons)b[c]="("+c+"|"+elizaSynons[c].join("|")+")";a.elizaKeywords&&void 0!==elizaKeywords.length||(elizaKeywords=[["###",0,[["###",[]]]]]);for(var d=/@(\S+)/,e=/(\S)\s*\*\s*(\S)/,f=/^\s*\*\s*(\S)/,g=/(\S)\s*\*\s*$/,h=/^\s*\*\s*$/,i=/\s+/g,j=0;elizaKeywords.length>j;j++){var k=elizaKeywords[j][2];elizaKeywords[j][3]=j;for(var c=0;k.length>c;c++){var l=k[c];if("$"==l[0].charAt(0)){for(var m=1;" "==l[0].charAt[m];)m++;l[0]=l[0].substring(m),l[2]=!0}else l[2]=!1;for(var n=d.exec(l[0]);n;){var o=b[n[1]]?b[n[1]]:n[1];l[0]=l[0].substring(0,n.index)+o+l[0].substring(n.index+n[0].length),n=d.exec(l[0])}if(h.test(l[0]))l[0]="\\s*(.*)\\s*";else{if(n=e.exec(l[0])){for(var p="",q=l[0];n;)p+=q.substring(0,n.index+1),")"!=n[1]&&(p+="\\b"),p+="\\s*(.*)\\s*","("!=n[2]&&"\\"!=n[2]&&(p+="\\b"),p+=n[2],q=q.substring(n.index+n[0].length),n=e.exec(q);l[0]=p+q}if(n=f.exec(l[0])){var p="\\s*(.*)\\s*";")"!=n[1]&&"\\"!=n[1]&&(p+="\\b"),l[0]=p+l[0].substring(n.index-1+n[0].length)}if(n=g.exec(l[0])){var p=l[0].substring(0,n.index+1);"("!=n[1]&&(p+="\\b"),l[0]=p+"\\s*(.*)\\s*"}}l[0]=l[0].replace(i,"\\s+"),i.lastIndex=0}}if(elizaKeywords.sort(this._sortKeywords),ElizaBot.prototype.pres={},ElizaBot.prototype.posts={},a.elizaPres&&elizaPres.length){for(var r=Array(),c=0;elizaPres.length>c;c+=2)r.push(elizaPres[c]),ElizaBot.prototype.pres[elizaPres[c]]=elizaPres[c+1];ElizaBot.prototype.preExp=RegExp("\\b("+r.join("|")+")\\b")}else ElizaBot.prototype.preExp=/####/,ElizaBot.prototype.pres["####"]="####";if(a.elizaPosts&&elizaPosts.length){for(var r=Array(),c=0;elizaPosts.length>c;c+=2)r.push(elizaPosts[c]),ElizaBot.prototype.posts[elizaPosts[c]]=elizaPosts[c+1];ElizaBot.prototype.postExp=RegExp("\\b("+r.join("|")+")\\b")}else ElizaBot.prototype.postExp=/####/,ElizaBot.prototype.posts["####"]="####";a.elizaQuits&&void 0!==elizaQuits.length||(elizaQuits=[]),ElizaBot.prototype._dataParsed=!0},ElizaBot.prototype._sortKeywords=function(a,b){return a[1]>b[1]?-1:a[1]<b[1]?1:a[3]>b[3]?1:a[3]<b[3]?-1:0},ElizaBot.prototype.transform=function(a){var b="";this.quit=!1,a=a.toLowerCase(),a=a.replace(/@#\$%\^&\*\(\)_\+=~`\{\[\}\]\|:;<>\/\\\t/g," "),a=a.replace(/\s+-+\s+/g,"."),a=a.replace(/\s*[,\.\?!;]+\s*/g,"."),a=a.replace(/\s*\bbut\b\s*/g,"."),a=a.replace(/\s{2,}/g," ");for(var c=a.split("."),d=0;c.length>d;d++){var e=c[d];if(""!=e){for(var f=0;elizaQuits.length>f;f++)if(elizaQuits[f]==e)return this.quit=!0,this.getFinal();var g=this.preExp.exec(e);if(g){for(var h="",i=e;g;)h+=i.substring(0,g.index)+this.pres[g[1]],i=i.substring(g.index+g[0].length),g=this.preExp.exec(i);e=h+i}this.sentence=e;for(var j=0;elizaKeywords.length>j;j++)if(e.search(RegExp("\\b"+elizaKeywords[j][0]+"\\b","i"))>=0&&(b=this._execRule(j)),""!=b)return b}}if(b=this._memGet(),""==b){this.sentence=" ";var j=this._getRuleIndexByKey("xnone");j>=0&&(b=this._execRule(j))}return""!=b?b:"I am at a loss for words."},ElizaBot.prototype._execRule=function(a){for(var b=elizaKeywords[a],c=b[2],d=/\(([0-9]+)\)/,e=0;c.length>e;e++){var f=this.sentence.match(c[e][0]);if(null!=f){var g=c[e][1],h=c[e][2],i=this.noRandom?0:Math.floor(Math.random()*g.length);this.noRandom&&this.lastchoice[a][e]>i||this.lastchoice[a][e]==i?(i=++this.lastchoice[a][e],i>=g.length&&(i=0,this.lastchoice[a][e]=-1)):this.lastchoice[a][e]=i;var j=g[i];if(this.debug&&alert("match:\nkey: "+elizaKeywords[a][0]+"\nrank: "+elizaKeywords[a][1]+"\ndecomp: "+c[e][0]+"\nreasmb: "+j+"\nmemflag: "+h),0==j.search("^goto ","i")&&(ki=this._getRuleIndexByKey(j.substring(5)),ki>=0))return this._execRule(ki);var k=d.exec(j);if(k){for(var l="",m=j;k;){var n=f[parseInt(k[1])],o=this.postExp.exec(n);if(o){for(var p="",q=n;o;)p+=q.substring(0,o.index)+this.posts[o[1]],q=q.substring(o.index+o[0].length),o=this.postExp.exec(q);n=p+q}l+=m.substring(0,k.index)+n,m=m.substring(k.index+k[0].length),k=d.exec(m)}j=l+m}if(j=this._postTransform(j),!h)return j;this._memSave(j)}}return""},ElizaBot.prototype._postTransform=function(a){if(a=a.replace(/\s{2,}/g," "),a=a.replace(/\s+\./g,"."),this.global.elizaPostTransforms&&elizaPostTransforms.length)for(var b=0;elizaPostTransforms.length>b;b+=2)a=a.replace(elizaPostTransforms[b],elizaPostTransforms[b+1]),elizaPostTransforms[b].lastIndex=0;if(this.capitalizeFirstLetter){var c=/^([a-z])/,d=c.exec(a);d&&(a=d[0].toUpperCase()+a.substring(1))}return a},ElizaBot.prototype._getRuleIndexByKey=function(a){for(var b=0;elizaKeywords.length>b;b++)if(elizaKeywords[b][0]==a)return b;return-1},ElizaBot.prototype._memSave=function(a){this.mem.push(a),this.mem.length>this.memSize&&this.mem.shift()},ElizaBot.prototype._memGet=function(){if(this.mem.length){if(this.noRandom)return this.mem.shift();for(var a=Math.floor(Math.random()*this.mem.length),b=this.mem[a],c=a+1;this.mem.length>c;c++)this.mem[c-1]=this.mem[c];return this.mem.length--,b}return""},ElizaBot.prototype.getFinal=function(){return ElizaBot.prototype.global.elizaFinals?elizaFinals[Math.floor(Math.random()*elizaFinals.length)]:""},ElizaBot.prototype.getInitial=function(){return ElizaBot.prototype.global.elizaInitials?elizaInitials[Math.floor(Math.random()*elizaInitials.length)]:""},Array.prototype.push===void 0&&(Array.prototype.push=function(a){return this[this.length]=a}),Array.prototype.shift===void 0&&(Array.prototype.shift=function(){if(0==this.length)return null;for(var a=this[0],b=1;this.length>b;b++)this[b-1]=this[b];return this.length--,a});